# Open Codelabs (Hands-on System)

[![Rust](https://img.shields.io/badge/rust-v1.75+-orange.svg)](https://www.rust-lang.org/)
[![Svelte](https://img.shields.io/badge/svelte-v5-ff3e00.svg)](https://svelte.dev/)
[![Bun](https://img.shields.io/badge/bun-v1.0+-black.svg)](https://bun.sh/)
[![Docker](https://img.shields.io/badge/docker-blue.svg)](https://www.docker.com/)
[![Firebase](https://img.shields.io/badge/firebase-yellow.svg)](https://firebase.google.com/)
[![Supabase](https://img.shields.io/badge/supabase-3FCF8E.svg)](https://supabase.com/)

**Open Codelabs** is an open-source platform designed to easily host and manage Google Codelab-style hands-on sessions. Built with a modern tech stack, it supports both Facilitator and Attendee roles, with content managed via Markdown or generated by AI.

[English](README.md) | [ÌïúÍµ≠Ïñ¥](README.ko.md) | [Êó•Êú¨Ë™û](README.ja.md) | [‰∏≠Êñá](README.zh.md)

---

## üöÄ Key Features

- **Facilitator & Attendee Separation**: Admins can create and manage codelabs, while participants follow steps through a refined UI.
- **AI Codelab Generator**: Automatically generate professional-grade codelabs from source code or reference documents using Google Gemini AI.
- **Code Server Workspaces (Optional)**: Create per-codelab code-server workspaces with step snapshots (branch/folder mode) and downloadable archives.
- **Quizzes, Feedback, and Certificates**: Gate certificate issuance with quiz scores and feedback submission; auto-generate verification URLs.
- **Prep Guide & Materials**: Author or AI-generate preparation guides and manage downloadable links/files per codelab.
- **Live Tools for Workshops**: Live chat/DM, help-queue, submissions panel, and a roulette raffle that draws only from certificate holders.
- **Multi-Runtime Support**: Run using a **Rust (Axum) + SQLite** backend for local/private sessions, or deploy with **Firebase (Firestore/Hosting)** or **Supabase** for a serverless experience.
- **Google Codelab Look & Feel**: Familiar and highly readable design inspired by Google's own codelabs.
- **Easy Public Access**: Integrated scripts for `ngrok`, `bore`, and `cloudflared` (Cloudflare Tunnel) to instantly expose your local server with QR code support for participants.
- **Multi-language Support**: Built-in i18n support for global workshops.

---

## ‚ö° Quickstart

Get the system up and running in seconds:

```bash
# Clone the repository
git clone https://github.com/JAICHANGPARK/open-codelabs.git
cd open-codelabs

# Start with Docker Compose
docker compose up --build
```

### ü¶≠ For Podman Users
If you are using Podman, you can use `podman-compose`:
```bash
podman-compose up --build
```
Or use the Podman Docker compatibility layer.

### üß± Use Prebuilt Images (GHCR)
If you want to skip local builds, use the published images:

```bash
cp .env.sample .env
docker compose -f docker-compose.images.yml up
```

---

## üõ† Tech Stack

### Frontend
- **Framework**: [SvelteKit 5](https://svelte.dev/) (Vite + TypeScript)
- **Runtime**: [Bun](https://bun.sh/)
- **Styling**: Tailwind CSS 4.0
- **State Management**: Svelte Runes
- **i18n**: `svelte-i18n`

### Backend (Self-hosted)
- **Language**: [Rust](https://www.rust-lang.org/)
- **Framework**: Axum (Tokio stack)
- **Database**: SQLite (via [SQLx](https://github.com/launchbadge/sqlx))

### Cloud (Serverless Option)
- **Platform**: [Firebase](https://firebase.google.com/) (Hosting, Firestore, Storage) or [Supabase](https://supabase.com/) (Postgres, Auth, Storage, Realtime)

---

## üìÇ Project Structure

```text
open-codelabs/
‚îú‚îÄ‚îÄ backend/          # Rust Axum API Server
‚îÇ   ‚îú‚îÄ‚îÄ src/          # API Logic
‚îÇ   ‚îî‚îÄ‚îÄ migrations/   # Database Migrations
‚îú‚îÄ‚îÄ frontend/         # SvelteKit Client
‚îÇ   ‚îú‚îÄ‚îÄ src/          # Components, Routes, & Libs
‚îÇ   ‚îî‚îÄ‚îÄ static/       # Static Assets
‚îú‚îÄ‚îÄ docs/             # Documentation (MkDocs)
‚îú‚îÄ‚îÄ docker-compose.images.yml # Prebuilt image compose file
‚îú‚îÄ‚îÄ docker-compose.yml # System Orchestration
‚îî‚îÄ‚îÄ run-public.sh     # Public Deployment Script (ngrok/bore/cloudflare)
```

---

## üö¶ Getting Started

### Prerequisites
- [Docker](https://www.docker.com/) & Docker Compose
- [Bun](https://bun.sh/) (For local development)
- [Rust](https://www.rust-lang.org/) (For local backend development)

### 1. Run with Docker (Recommended)
The simplest way to get the full system up and running.

> **Note**: By default, data is stored in `~/open-codelabs` on your host machine. You can customize this by editing `DATA_VOLUME_PATH` in the `.env` file at the root directory.
> - **macOS/Linux**: `~/open-codelabs`
> - **Windows**: `C:/open-codelabs` (Use forward slashes `/`)

```bash
docker-compose up --build
```
- **Frontend**: [http://localhost:5173](http://localhost:5173)
- **Backend API**: [http://localhost:8080](http://localhost:8080)

### 2. Local Development

#### Backend
```bash
cd backend
# Create .env (DATABASE_URL=sqlite:data/sqlite.db?mode=rwc)
# Required: ADMIN_ID, ADMIN_PW
# Optional: see Environment Variables below
cargo run
```

#### Frontend
```bash
cd frontend
bun install
# Create .env (VITE_API_URL=http://localhost:8080)
bun run dev
```

### 3. Environment Variables (.env)

Docker Compose reads `.env` at the repo root. Copy `.env.sample` to `.env` and adjust as needed.
(For local dev, `backend/.env.sample` and `frontend/.env.sample` are minimal starting points.)

**Images (docker-compose.images.yml)**
- `IMAGE_REGISTRY`: Container registry for prebuilt images (default `ghcr.io`).
- `IMAGE_NAMESPACE`: Image namespace or org (default `open-codelabs`).
- `IMAGE_TAG`: Image tag to pull (default `latest`).

**Backend**
- `DATABASE_URL`: SQLx connection string (sqlite/postgres). Example: `sqlite:/app/data/sqlite.db?mode=rwc`.
- `ADMIN_ID`: Admin login username.
- `ADMIN_PW`: Admin login password; also used to decrypt Gemini API keys from the frontend.
- `AUTH_SECRETS`: Comma-separated JWT signing secrets (first is active; others allow rotation). Falls back to `ADMIN_PW` if empty.
- `AUTH_ISSUER`: JWT issuer claim.
- `AUTH_AUDIENCE`: JWT audience claim.
- `ADMIN_SESSION_TTL_SECONDS`: Admin session TTL in seconds.
- `ATTENDEE_SESSION_TTL_SECONDS`: Attendee session TTL in seconds.
- `COOKIE_SECURE`: Set `true` for HTTPS (Secure cookies + `__Host-` prefix). Required for `COOKIE_SAMESITE=none`.
- `COOKIE_SAMESITE`: `lax` (default), `strict`, or `none`.
- `TRUST_PROXY`: Set `true` behind a reverse proxy to trust `X-Forwarded-*` headers.
- `CORS_ALLOWED_ORIGINS`: Comma-separated list of allowed origins; empty uses localhost defaults.
- `RATE_LIMIT_GENERAL_PER_MINUTE`: Per-IP limit for general API requests.
- `RATE_LIMIT_LOGIN_PER_5_MIN`: Per-IP limit for login requests (5-minute window).
- `RATE_LIMIT_AI_PER_MINUTE`: Per-IP limit for AI proxy requests.
- `RATE_LIMIT_UPLOAD_PER_MINUTE`: Per-IP limit for upload and submission POSTs.
- `CSP_HEADER`: Override Content-Security-Policy for UI responses; empty uses the built-in default.
- `HSTS_HEADER`: Override Strict-Transport-Security; applied only on HTTPS.
- `ALLOWED_GEMINI_MODELS`: Comma-separated allowlist of Gemini model IDs.

**AI**
- `GEMINI_API_KEY`: Default Gemini API key if an admin key is not provided.

**Frontend**
- `VITE_API_URL`: Base URL for the backend API (e.g. `http://localhost:8080` or `http://backend:8080` in Docker).
- `VITE_ADMIN_ENCRYPTION_PASSWORD`: Password used by the frontend to encrypt Gemini API keys; must match backend `ADMIN_PW`.
- `VITE_USE_SUPABASE`: Set `true` to enable Supabase mode (serverless, no Rust backend).
- `VITE_SUPABASE_URL`: Supabase project URL.
- `VITE_SUPABASE_ANON_KEY`: Supabase anon key.
- `VITE_SUPABASE_STORAGE_BUCKET`: Supabase Storage bucket name (default `open-codelabs`).
- `VITE_ADMIN_ID`: Admin login ID for Firebase/Supabase modes.
- `VITE_ADMIN_PW`: Admin login password for Firebase/Supabase modes.
- `FRONTEND_PORT`: Port to bind the frontend server/container.
- `FRONTEND_HOST`: Host interface to bind (e.g. `0.0.0.0`).

### 4. Cloud Deployment (AWS / GCP / Firebase)
To run in a serverless environment or on the cloud, you can use AWS, GCP or Firebase.
- **AWS**: Container-based or VM deployment. See [AWS Deployment Guide](docs/self-hosting/aws.md).
- **GCP (Cloud Run)**: Container-based deployment. See [GCP Deployment Guide](docs/self-hosting/gcp.md).
- **Firebase**: Quick serverless setup. See [Firebase Deployment Guide](docs/self-hosting/firebase.md).
- **Supabase**: Serverless Postgres + Storage setup. See [Supabase Guide](docs/self-hosting/supabase.md).

---

## ü§ñ AI Codelab Generator
Open Codelabs features a built-in AI generator that transforms your code into structured tutorials.
1. Enter your Gemini API Key in the settings.
2. Provide source code or a technical description.
3. Let AI generate the steps, explanations, and verification audits for you.

---

## üß≠ Facilitator Toolkit (New)
- **Live tab**: Monitor attendees, chat/DM, and resolve help requests in real time.
- **Quiz & Feedback**: Configure completion requirements; results are aggregated per attendee.
- **Prep Guide & Materials**: Draft a preparation guide and attach links/files for the session.
- **Submissions**: Collect and review uploaded artifacts from attendees.
- **Certificate Raffle**: Spin a roulette that selects only certificate-issued attendees (fair giveaways).

---

## üåê Exposing to Public (ngrok / bore / cloudflare)
When hosting a workshop on your local machine, use the `run-public.sh` script to provide external access.

```bash
chmod +x run-public.sh
./run-public.sh --ngrok  # Using ngrok
# OR
./run-public.sh --bore   # Using bore (Rust-based)
# OR
./run-public.sh --cloudflare  # Using Cloudflare Tunnel
```

---

## üìö Documentation
Full documentation is available at GitHub Pages:
**[üìñ View Open Codelabs Documentation](https://JAICHANGPARK.github.io/open-codelabs/)**

Additional guides:
- [Code Server Workspace Setup](docs/CODE_SERVER_SETUP.md)

---

## üìÑ License
This project is licensed under the [Apache License 2.0](LICENSE).
